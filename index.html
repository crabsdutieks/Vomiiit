<!doctype html>

<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Vomit Run</title>
<style>
html,body { margin:0; padding:0; height:100%; background:#0a0a0a; color:#fff; font-family:sans-serif; overflow:hidden; }
button { padding:10px 20px; font-size:18px; border:none; border-radius:8px; cursor:pointer; background:linear-gradient(135deg,#00ff99,#00ccff); color:#000; font-weight:bold; box-shadow:0 4px 10px rgba(0,0,0,0.4); }
button:active { transform:scale(0.95); }
#menu, #gameover { position:absolute; inset:0; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:20px; background:rgba(0,0,0,0.85); z-index:10; backdrop-filter:blur(10px); }
#hud { position:absolute; top:10px; left:10px; font-size:20px; z-index:5; text-shadow:0 0 5px #000; }
canvas { display:block; }
#combo { position:absolute; top:10px; right:10px; font-size:18px; z-index:5; color:#ff0; text-shadow:0 0 5px #000; }
#ultraBar { position:absolute; bottom:10px; left:50%; transform:translateX(-50%); width:80%; height:20px; background:#333; border-radius:10px; overflow:hidden; }
#ultraFill { height:100%; background:linear-gradient(90deg,#ff0,#f0f); width:0%; transition:width 0.2s; }
</style>
</head>
<body>
<div id="hud">Score: <span id="score">0</span></div>
<div id="combo">Combo: x1</div>
<div id="ultraBar"><div id="ultraFill"></div></div>
<div id="menu">
  <h1 style="color:#0ff;">VOMIT RUN</h1>
  <p>Vise, relâche et inonde les cibles. Enchaîne pour l'Ultra Vomit !</p>
  <button id="start">Jouer</button>
</div>
<div id="gameover" style="display:none;">
  <h2>Game Over</h2>
  <p>Score: <span id="finalscore">0</span></p>
  <button id="restart">Rejouer</button>
  <button id="share">Partager sur Twitter</button>
</div>
<canvas id="game"></canvas>
<audio id="bgm" loop src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_1e50c7fa68.mp3?filename=fun-background-music-111365.mp3"></audio>
<audio id="hitSfx" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_58a6d85f8e.mp3?filename=pop-94319.mp3"></audio>
<audio id="ultraSfx" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_b3c5480b2d.mp3?filename=retro-game-notification-3-236689.mp3"></audio>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const bgm=document.getElementById('bgm');
const hitSfx=document.getElementById('hitSfx');
const ultraSfx=document.getElementById('ultraSfx');
let w,h; function resize(){w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;} resize();
window.addEventListener('resize',resize);
let running=false, score=0, targets=[], combo=1, comboTimer=0, ultra=0, audioUnlocked=false;
const scoreEl=document.getElementById('score');
const comboEl=document.getElementById('combo');
const ultraFill=document.getElementById('ultraFill');
function spawn(){ targets.push({x:Math.random()*w,y:-30,vy:2+Math.random()*2, r:20, hit:false}); }
function update(){
  targets.forEach(t=>t.y+=t.vy);
  targets = targets.filter(t=>!t.hit && t.y< h+30);
  if(comboTimer>0){comboTimer--; if(comboTimer===0) combo=1;}
}
function draw(){
  const grad=ctx.createLinearGradient(0,0,0,h);
  grad.addColorStop(0,'#021'); grad.addColorStop(1,'#052');
  ctx.fillStyle=grad; ctx.fillRect(0,0,w,h);
  targets.forEach(t=>{
    ctx.beginPath();
    const radgrad=ctx.createRadialGradient(t.x,t.y,5,t.x,t.y,t.r);
    radgrad.addColorStop(0,'#0f0');
    radgrad.addColorStop(1,'#060');
    ctx.fillStyle=radgrad;
    ctx.arc(t.x,t.y,t.r,0,Math.PI*2);
    ctx.fill();
  });
}
function loop(){ if(!running) return; update(); draw(); requestAnimationFrame(loop); }
function hit(mx,my){
  let hitSomething=false;
  for(let i=targets.length-1;i>=0;i--){const t=targets[i]; if((mx-t.x)**2+(my-t.y)**2<t.r*t.r){t.hit=true; score+=1*combo; ultra=Math.min(100,ultra+10); combo++; comboTimer=60; hitSomething=true;}}
  if(hitSomething){ scoreEl.textContent=score; comboEl.textContent=`Combo: x${combo}`; ultraFill.style.width=ultra+'%'; hitSfx.currentTime=0; hitSfx.play();
    if(ultra===100){ ultraSfx.currentTime=0; ultraSfx.play(); targets.forEach(t=>t.hit=true); score+=targets.length*combo; targets=[]; ultra=0; ultraFill.style.width='0%'; }
  }
}
canvas.addEventListener('click', e=>{ if(running) hit(e.offsetX,e.offsetY); });
canvas.addEventListener('touchstart', e=>{ if(running){ const t=e.touches[0]; hit(t.clientX,t.clientY); }});
setInterval(()=>{if(running) spawn();},1000);
const menu=document.getElementById('menu');
const gameover=document.getElementById('gameover');
function unlockAudio(){ if(!audioUnlocked){ bgm.play().catch(()=>{}); audioUnlocked=true; } }
document.getElementById('start').onclick=()=>{unlockAudio(); menu.style.display='none';startGame();};
document.getElementById('restart').onclick=()=>{unlockAudio(); gameover.style.display='none';startGame();};
document.getElementById('share').onclick=()=>{const text=encodeURIComponent(`J'ai fait ${score} sur Vomit Run!`);const url=encodeURIComponent(location.href);window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`,'_blank');};
function startGame(){running=true;score=0;combo=1;comboTimer=0;ultra=0;targets=[];scoreEl.textContent=score;comboEl.textContent='Combo: x1';ultraFill.style.width='0%';loop();}
setInterval(()=>{if(running && targets.some(t=>t.y>h-20)){running=false;document.getElementById('finalscore').textContent=score;gameover.style.display='flex';}},500);
</script>
</body>
</html>
