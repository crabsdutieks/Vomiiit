<!doctype html>

<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Tip Toss</title>
<meta name="theme-color" content="#0b0b12" />
<style>
  :root{ --bg:#0b0b12; --panel:#121623cc; --txt:#eef2ff; --muted:#9aa3b2; --acc:#22c55e; --warn:#f59e0b; --danger:#ef4444; }
  html,body{margin:0;height:100%;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;overflow:hidden;-webkit-user-select:none;user-select:none;}
  canvas{position:fixed;inset:0;display:block;touch-action:none;background:radial-gradient(1200px 800px at 50% 15%,#1a2040 0%,#0b0b12 60%);} 
  .hud{position:fixed;inset:0;pointer-events:none}
  .row{position:fixed;left:0;right:0;display:flex;gap:10px;align-items:center;pointer-events:auto}
  .top{top:env(safe-area-inset-top);padding:10px 14px;justify-content:space-between}
  .bottom{bottom:calc(env(safe-area-inset-bottom) + 10px);padding:0 14px;justify-content:space-between}
  .card{display:flex;gap:10px;align-items:center;padding:10px 14px;border-radius:16px;background:var(--panel);backdrop-filter:blur(10px);box-shadow:0 10px 30px #0006}
  .score{font-weight:800;font-size:18px}
  .muted{color:var(--muted);font-size:12px}
  .btn{pointer-events:auto;border:0;border-radius:16px;padding:12px 16px;background:#141c27;color:var(--txt);font-weight:700;box-shadow:0 6px 18px #0007;display:inline-flex;align-items:center;gap:8px}
  .btn.acc{background:var(--acc);color:#041007}
  .btn.warn{background:var(--warn);color:#111}
  .btn.icon{padding:10px;border-radius:14px;width:44px;height:44px;justify-content:center}
  .meter{height:10px;border-radius:999px;background:#111826;border:1px solid #253041;overflow:hidden}
  .meter>i{display:block;height:100%;background:linear-gradient(90deg,#22c55e,#06b6d4,#3b82f6,#a855f7);width:0%}
  .overlay{position:fixed;inset:0;display:grid;place-items:center;background:linear-gradient(180deg,#02060acc,transparent 40%),radial-gradient(1000px 600px at 50% -10%,#1b2636bb 0%,transparent 60%);} 
  .panel{width:min(680px,92vw);border-radius:22px;background:var(--panel);backdrop-filter:blur(12px);box-shadow:0 20px 60px #000a;padding:22px}
  .title{font-size:36px;font-weight:900;letter-spacing:1px;text-align:center;margin:6px 0 6px;background:linear-gradient(90deg,#22c55e,#3b82f6,#a855f7);-webkit-background-clip:text;background-clip:text;color:transparent}
  .rowbtn{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
  .hidden{display:none}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div class="hud">
  <div class="row top">
    <div class="card" style="gap:14px;min-width:210px">
      <div>
        <div class="score">Score: <span id="score">0</span></div>
        <div class="muted" id="combo">Combo x1</div>
      </div>
      <div style="flex:1"></div>
      <div style="min-width:150px">
        <div class="muted" style="margin-bottom:6px">Barre Suspicion</div>
        <div class="meter"><i id="sus"></i></div>
      </div>
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn icon" id="btn-pause">‚è∏</button>
      <button class="btn icon" id="btn-sfx">üîä</button>
      <button class="btn icon" id="btn-music">üéµ</button>
    </div>
  </div>
  <div class="row bottom">
    <div class="card">Tape pour lancer un billet. Quand la porte s'ouvre ‚Üí <b>NE TOUCHE PLUS</b>.</div>
    <div style="display:flex;gap:8px">
      <button class="btn" id="btn-share">Partager</button>
    </div>
  </div>
</div><!-- Overlays --><div class="overlay" id="ov-start">
  <div class="panel">
    <div class="title">Tip Toss</div>
    <p style="opacity:.9;text-align:center;margin:8px 0 14px">Spectacle burlesque stylis√© (aucune nudit√©). Lance des billets dans le <b>rythme</b>, mais cache-toi quand la porte s'entrouvre‚Ä¶</p>
    <div class="rowbtn">
      <button class="btn acc" id="btn-play">‚ñ∂ Jouer</button>
      <button class="btn" id="btn-how">Comment jouer</button>
    </div>
  </div>
</div>
<div class="overlay hidden" id="ov-how">
  <div class="panel">
    <div class="title">Comment jouer</div>
    <ul style="line-height:1.6;margin:0 0 10px 0">
      <li>Tape sur l'√©cran quand le <b>cercle de beat</b> se ferme pour un lancer parfait.</li>
      <li>Chaque r√©ussite augmente le <b>combo</b> et ton score.</li>
      <li>Si la <b>porte</b> brille ‚Üí ne tape pas. Taper pendant ce temps augmente la <b>Suspicion</b>.</li>
      <li>Suspicion √† 100% ‚Üí Game Over.</li>
    </ul>
    <div class="rowbtn"><button class="btn" id="btn-how-back">OK</button></div>
  </div>
</div>
<div class="overlay hidden" id="ov-pause">
  <div class="panel"><div class="title">Pause</div>
    <div class="rowbtn"><button class="btn acc" id="btn-resume">‚èµ Reprendre</button><button class="btn" id="btn-restart">‚Üª Recommencer</button></div>
  </div>
</div>
<div class="overlay hidden" id="ov-over">
  <div class="panel">
    <div class="title">C'est cram√© !</div>
    <p style="text-align:center;opacity:.9" id="final">Score 0 ‚Ä¢ Combo x1</p>
    <div class="rowbtn"><button class="btn acc" id="btn-replay">‚Üª Rejouer</button><button class="btn" id="btn-share2">Partager</button></div>
  </div>
</div><audio id="bgm" loop src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_1e50c7fa68.mp3?filename=fun-background-music-111365.mp3"></audio> <audio id="sfxHit" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_58a6d85f8e.mp3?filename=pop-94319.mp3"></audio> <audio id="sfxBad" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2f3df8b5e0.mp3?filename=wrong-47985.mp3"></audio> <audio id="sfxDoor" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2b45a5ee9d.mp3?filename=open-door-115105.mp3"></audio>

<script>
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  const W = () => window.innerWidth, H = () => window.innerHeight;
  const scoreEl = document.getElementById('score');
  const comboEl = document.getElementById('combo');
  const susEl = document.getElementById('sus');
  const ovStart = document.getElementById('ov-start');
  const ovHow = document.getElementById('ov-how');
  const ovPause = document.getElementById('ov-pause');
  const ovOver = document.getElementById('ov-over');
  const final = document.getElementById('final');
  const btn = id => document.getElementById(id);
  const bgm = document.getElementById('bgm');
  const sfxHit = document.getElementById('sfxHit');
  const sfxBad = document.getElementById('sfxBad');
  const sfxDoor = document.getElementById('sfxDoor');

  // Resize
  function resize(){ canvas.width = W(); canvas.height = H(); }
  window.addEventListener('resize', resize, { passive:true });
  resize();

  // Game state
  const state = { running:false, paused:false, score:0, combo:1, comboT:0, suspicion:0, beat:0,
    dancerT:0, bills:[], door: {open:false,t:0,cd: 3+Math.random()*3}, audioReady:false, musicOn:true, sfxOn:true };

  function reset(){
    state.running=true; state.paused=false; state.score=0; state.combo=1; state.comboT=0; state.suspicion=0; state.beat=0; state.dancerT=0; state.bills.length=0; state.door={open:false,t:0,cd: 2+Math.random()*3};
    updateHUD();
  }

  function updateHUD(){ scoreEl.textContent=state.score; comboEl.textContent = `Combo x${state.combo}`; susEl.style.width = Math.min(100, state.suspicion)+'%'; }

  // Simple soundtrack unlock
  function unlockAudio(){ if(!state.audioReady){ bgm.volume=0.35; state.musicOn && bgm.play().catch(()=>{}); state.audioReady=true; } }

  // Input
  function tap(){ if(!state.running||state.paused) return; 
    if(state.door.open){ // bad ‚Äî wife checks
      state.suspicion = Math.min(100, state.suspicion + 35);
      if(state.sfxOn){ sfxBad.currentTime=0; sfxBad.play(); }
      state.combo=1; state.comboT=0; updateHUD();
      if(state.suspicion>=100) return gameOver();
      return;
    }
    // good: throw bill timed to beat
    const perfect = state.beat>0.75 || state.beat<0.15; // ring near the beat
    const x = W()*0.55 + (Math.random()*40-20);
    const y = H()*0.5 + (Math.random()*20-10);
    state.bills.push({x:W()*0.25, y:H()*0.85, vx:(x - W()*0.25)/20, vy:(y - H()*0.85)/20, t:0, life:20, good:perfect});
    const base = perfect ? 10 : 5;
    state.score += base*state.combo;
    state.combo += (perfect?1:0);
    state.comboT = 1.8;
    if(state.sfxOn){ sfxHit.currentTime=0; sfxHit.play(); }
    updateHUD();
  }

  canvas.addEventListener('pointerdown', (e)=>{ e.preventDefault(); tap(); }, { passive:false });

  // Buttons
  btn('btn-play').onclick = ()=>{ unlockAudio(); ovStart.classList.add('hidden'); reset(); };
  btn('btn-how').onclick = ()=> ovHow.classList.remove('hidden');
  btn('btn-how-back').onclick = ()=> ovHow.classList.add('hidden');
  btn('btn-pause').onclick = ()=>{ if(!state.running) return; state.paused=true; ovPause.classList.remove('hidden'); };
  btn('btn-resume').onclick = ()=>{ state.paused=false; ovPause.classList.add('hidden'); };
  btn('btn-restart').onclick = ()=>{ ovPause.classList.add('hidden'); reset(); };
  btn('btn-replay').onclick = ()=>{ ovOver.classList.add('hidden'); reset(); };
  function share(){ const text=encodeURIComponent(`J'ai fait ${state.score} sur Tip Toss üí∏ Essaie de me battre !`); const url=encodeURIComponent(location.href); window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`,'_blank'); }
  btn('btn-share').onclick = share; btn('btn-share2').onclick = share;
  btn('btn-sfx').onclick = ()=>{ state.sfxOn=!state.sfxOn; btn('btn-sfx').textContent = state.sfxOn? 'üîä':'üîà'; };
  btn('btn-music').onclick = ()=>{ state.musicOn=!state.musicOn; btn('btn-music').textContent = state.musicOn? 'üéµ':'üîá'; if(state.musicOn){ unlockAudio(); } else { bgm.pause(); } };

  function gameOver(){ state.running=false; final.textContent = `Score ${state.score} ‚Ä¢ Combo x${state.combo}`; ovOver.classList.remove('hidden'); }

  // Drawing helpers
  function drawSpotlights(){
    const w=W(), h=H();
    const g=ctx.createLinearGradient(0,0,0,h*0.8); g.addColorStop(0,'rgba(100,140,255,0.25)'); g.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=g; ctx.beginPath(); ctx.moveTo(w*0.45,0); ctx.lineTo(w*0.65,0); ctx.lineTo(w*0.75,h); ctx.lineTo(w*0.35,h); ctx.closePath(); ctx.fill();
  }
  function drawStage(){
    const w=W(), h=H();
    ctx.fillStyle='#080a10'; ctx.fillRect(0,h*0.82,w,h*0.18);
    // front glow
    const g=ctx.createLinearGradient(0,h*0.82,0,h); g.addColorStop(0,'rgba(34,197,94,0.1)'); g.addColorStop(1,'rgba(0,0,0,0)');
    ctx.fillStyle=g; ctx.fillRect(0,h*0.82,w,h*0.18);
  }
  function drawDancer(dt){
    // Stylized silhouette dancer (burlesque, no nudity)
    const w=W(), h=H();
    state.dancerT += dt;
    const bx = w*0.58, by = h*0.6;
    ctx.save();
    ctx.translate(bx, by);
    ctx.scale(1,1);
    ctx.fillStyle='rgba(0,0,0,0.75)';
    ctx.strokeStyle='rgba(180,220,255,0.35)'; ctx.lineWidth=4;
    // torso
    ctx.beginPath(); ctx.moveTo(-20,-80); ctx.quadraticCurveTo(0,-110,20,-80); ctx.quadraticCurveTo(28,-40,0,-20); ctx.quadraticCurveTo(-28,-40,-20,-80); ctx.closePath(); ctx.fill();
    // head
    ctx.beginPath(); ctx.arc(0,-120,18,0,Math.PI*2); ctx.fill();
    // arms (waving)
    const a = Math.sin(state.dancerT*3)*0.8;
    ctx.beginPath(); ctx.moveTo(-18,-70); ctx.quadraticCurveTo(-50+a*10,-110, -70+a*20,-80); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(18,-70); ctx.quadraticCurveTo(50-a*10,-110, 70-a*20,-80); ctx.stroke();
    // legs (step)
    ctx.beginPath(); ctx.moveTo(-8,0); ctx.quadraticCurveTo(-18,40*Math.sin(state.dancerT*2), -4,60); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(8,0); ctx.quadraticCurveTo(18,40*Math.cos(state.dancerT*2), 4,60); ctx.stroke();
    // skirt silhouette
    ctx.beginPath(); ctx.moveTo(-40,-20); ctx.quadraticCurveTo(0,10,40,-20); ctx.lineTo(28,10); ctx.quadraticCurveTo(0,28,-28,10); ctx.closePath(); ctx.fill();
    ctx.restore();
  }
  function drawBills(dt){
    for(let i=state.bills.length-1;i>=0;i--){ const b=state.bills[i]; b.t+=dt; b.x+=b.vx; b.y+=b.vy; b.vy*=0.98; 
      // bill sprite
      ctx.save(); ctx.translate(b.x,b.y); ctx.rotate(0.1*Math.sin(b.t*8));
      ctx.fillStyle = b.good? '#b1ffce' : '#c7ffd6';
      ctx.strokeStyle = '#0a6'; ctx.lineWidth=2; ctx.fillRect(-24,-12,48,24); ctx.strokeRect(-24,-12,48,24);
      ctx.fillStyle='#0a6'; ctx.beginPath(); ctx.arc(0,0,6,0,Math.PI*2); ctx.fill();
      ctx.restore();
      if(b.t> b.life) state.bills.splice(i,1);
    }
  }
  function drawDoor(dt){
    const w=W(), h=H();
    state.door.cd -= dt; if(state.door.cd<=0 && !state.door.open){
      state.door.open=true; state.door.t=0; state.door.cd = 3+Math.random()*4; if(state.sfxOn){ sfxDoor.currentTime=0; sfxDoor.play(); }
    }
    if(state.door.open){ state.door.t += dt; if(state.door.t>1.2){ state.door.open=false; state.door.t=0; }
    }
    // draw glowing door at left
    const openAmt = state.door.open? Math.min(1, state.door.t/0.2) : 0;
    ctx.save();
    ctx.translate(w*0.07, h*0.55);
    ctx.fillStyle = '#111'; ctx.fillRect(-30,-100,60,200);
    // slit of light
    ctx.globalCompositeOperation='lighter';
    const grad=ctx.createLinearGradient(-5,-80,5,80); grad.addColorStop(0,'rgba(255,240,150,'+(0.3+0.4*openAmt)+')'); grad.addColorStop(1,'rgba(255,200,80,0)');
    ctx.fillStyle=grad; ctx.fillRect(-5,-90,10,180);
    ctx.restore();
  }
  function drawBeat(dt){
    state.beat = (state.beat + dt*0.6) % 1; // loop 1s~
    const w=W(), h=H();
    const r = 70 * (1 - state.beat);
    ctx.save();
    ctx.translate(w*0.28, h*0.86);
    ctx.strokeStyle='rgba(180,255,220,0.8)'; ctx.lineWidth=4; ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.stroke();
    ctx.restore();
  }

  // Main loop
  let prev=0; function tick(ts){ const t=ts*0.001; const dt=Math.min(0.033, prev? t-prev : 0.016); prev=t;
    if(state.running && !state.paused){
      // decay combo timer
      if(state.comboT>0){ state.comboT-=dt; if(state.comboT<=0){ state.combo=1; comboEl.textContent='Combo x1'; } }
      // draw
      ctx.clearRect(0,0,W(),H());
      drawSpotlights(); drawStage(); drawDancer(dt); drawBills(dt); drawDoor(dt); drawBeat(dt);
    }
    requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);

  // Share
  function share(){ const text=encodeURIComponent(`J'ai fait ${state.score} sur Tip Toss üí∏ Essaie de me battre !`); const url=encodeURIComponent(location.href); window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`,'_blank'); }
  document.getElementById('btn-share').onclick = share; document.getElementById('btn-share2').onclick = share;
})();
</script></body>
</html>
